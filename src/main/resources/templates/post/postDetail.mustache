{{>layout/header}}
<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">게시글 상세보기</h1>
    </div>
    <div class="container">
            <table class="board_detail">
                <tr>
                    <td>제목 : </td>
                    <td>{{postVO.title}}</td>
                    <td>작성자 : {{postVO.writeId}}</td>
                </tr>
                <tr>
                    <td>내용 : </td>
                    <td colspan="2">
                        {{{postVO.content}}}
                    </td>
                </tr>
            </table>
        {{#write}}
            <form id="frm" name="frm" method="get" action="/post/modify">
                <input type="hidden" name="no" value="{{postVO.postSeq}}">
                <input type="submit" id="submit" value="수정" class="btn">
            </form>
            <form id="frm" name="frm" method="post" action="/post">
                <input type="hidden" name="_method" value="patch">
                <input type="hidden" name="no" value="{{postVO.postSeq}}">
                <input type="submit" id="submit" value="삭제" class="btn">
            </form>
        {{/write}}
        <input type="button" onclick="history.back()" value="이전" class="btn">
        <form method="post" action="/comment">
            <table class="board_detail">
                <tr>
                    <td>댓글</td>
                    <td><input type="text" id="content" name="content"></td>
                    <input type="hidden" name="postSeq" value="{{postVO.postSeq}}">
                    <input type="hidden" name="commentSeq" value=0>
                    <input type="hidden" name="commentDepth" value=0>
                </tr>
            </table>
            <input type="submit" id="submit" value="저장" class="btn">
        </form>

        {{#commentList}}
            <div class="col-xl-3">
                <div class="card border-left h-10 py-2" id="parentComment-{{commentSeq}}">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="border-bottom mb-1">
                                    <div class="text-xl-left font-weight-bold text-primary text-uppercase mb-1" style="float: left">
                                        {{commentWriteId}}
                                    </div>
                                    <div class="text-xs text-right font-weight-bold text-uppercase mb-1">
                                        {{commentWriteDt}}
                                    </div>
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 mt-2" style="float: left">
                                    <input type="hidden" id="commentContent-{{commentSeq}}" value="{{content}}">
                                    {{content}}
                                </div>
                                {{#isWrite}}
                                <div class="h5 mb-0 font-weight-bold text-gray-800 text-xl-left" style="float: right">
                                <nav class="navbar mb-0 text-right" style="padding: 0rem 0.5rem;">
                                            <div class="navbar text-xs text-right font-weight-bold text-uppercase mb-0" data-toggle="dropdown">
                                                <i class="fas fa-solid fa-ellipsis-h -align-center mt-2"></i>
                                            </div>
                                            <div class="dropdown-menu dropdown-menu-right animated--fade-in" aria-labelledby="navbarDropdown">
                                                <a class="dropdown-item" onclick="return modifyComment({{commentSeq}}, {{postSeq}}, '{{content}}')">수정</a>
                                                <form class="mr-1" method="post" action="/comment">
                                                    <input type="hidden" name="_method" value="patch">
                                                    <input type="hidden" name="commentSeq" value="{{commentSeq}}">
                                                    <input type="hidden" name="postSeq" value="{{postVO.postSeq}}">
                                                <button class="dropdown-item" type="submit">삭제</button>
                                                </form>
                                            </div>
                                </nav>
                                </div>
                                {{/isWrite}}


                            </div>
                        </div>
                    </div>
                    <div class="col mr-2">
                        <!-- 좋아요 -->
                        <span class="mr-1">
                            <i class="fas fa-thumbs-up -align-center mt-2"></i>
                            <span class="text-xs">999</span>
                        </span>
                        <span class="mr-1" id="reply-{{commentSeq}}" onclick="return reply({{commentSeq}})">답글</span>
                    </div>
                    <!-- 답글 없으면 안 보이게 -->
                    <div class="col mr-2">
                        <span class="mr-1 text-primary" id="onReplyComment-{{commentSeq}}" onclick="return onReplyComment({{commentSeq}})">
                            <i class="fas fa-solid fa-caret-down mr-1"></i>답글 보기
                        </span>
                        <span class="mr-1 text-primary" id="offReplyComment-{{commentSeq}}" onclick="return offReplyComment({{commentSeq}})" style="display: none">
                            <i class="fas fa-solid fa-caret-up mr-1"></i>답글 닫기
                        </span>
                    </div>

                </div>


                <div class="col-xl-3" id="modifyDiv-{{commentSeq}}" style="display: none"></div>


                <div class="card border-left h-10 py-2" id="parentCommentMod-{{commentSeq}}" style="display: none">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    <form method="post" action="/">
                                        <input type="hidden" name="_method" value="put">
                                        <input type="text" id="content" name="content" value="{{content}}">
                                        <input type="submit" id="submit" value="저장" class="btn">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



            </div>
                <div class="col-xl-3"  id="replyCommentPost-{{commentSeq}}" style="display: none">
                    <form method="post" action="/comment">
                        <table class="board_detail">
                            <tr>
                                <td>댓글</td>
                                <td><input type="text" id="content" name="content"></td>
                                <input type="hidden" name="postSeq" value="{{postVO.postSeq}}">
                                <input type="hidden" name="commentSeq" value="{{commentSeq}}">
                                <input type="hidden" name="commentDepth" value=1>
                            </tr>
                        </table>
                        <input type="submit" id="submit" value="저장" class="btn">
                    </form>
                </div>
            <div id="replyDiv-{{commentSeq}}" style="display: none"></div>
        {{/commentList}}
    </div>
</div>
<script type="text/javascript">
    //대댓글 출력하기
    function onReplyComment(commentSeq){
        const replyDiv = document.getElementById('replyDiv-'+commentSeq);
        const onReplyComment = document.getElementById('onReplyComment-'+commentSeq);
        const offReplyComment = document.getElementById('offReplyComment-'+commentSeq);

        replyDiv.style.display = ""
        onReplyComment.style.display = "none"
        offReplyComment.style.display = ""

        $.ajax({
            url:"/api/replyList",
            type:"get",
            dataType: 'json',
            data:{"commentSeq":commentSeq},
            success:function(ReplyCommentList){
                const html = document.createElement("div");
                html.id = "replyList-" + commentSeq;

                if (ReplyCommentList.length > 0) {
                    for(let i = 0; i < ReplyCommentList.length; i++) {
                        if (ReplyCommentList[i].writer > 0) {
                            html.innerHTML+= '<div class="col-xl-4" style="padding-left: 3rem">' +
                                    '<div class="card border-left h-10 py-2" id="childComment-' + ReplyCommentList[i].commentSeq + '">' +
                                    '<div class="card-body">' +
                                    '<div class="row no-gutters align-items-center">' +
                                    '<div class="col mr-2">' +
                                    '<div class="border-bottom mb-1">' +
                                    '<div class="text-xl-left font-weight-bold text-primary text-uppercase mb-1" style="float: left">'+
                                    ReplyCommentList[i].commentWriteId +
                                    '</div>' +
                                    '<div class="text-xs text-right font-weight-bold text-uppercase mb-1">'+
                                    ReplyCommentList[i].commentWriteDt +
                                    '</div></div>' +
                                    '<div class="h5 mb-0 font-weight-bold text-gray-800 mt-2" style="float: left">'+
                                    ReplyCommentList[i].content +
                                    '</div>' +
                                    '<div class="h5 mb-0 font-weight-bold text-gray-800 text-xl-left" style="float: right">' +
                                    '<nav class="navbar mb-0 text-right" style="padding: 0rem 0.5rem;">' +
                                    '<div class="navbar text-xs text-right font-weight-bold text-uppercase mb-0" data-toggle="dropdown">' +
                                    '<i class="fas fa-solid fa-ellipsis-h -align-center mt-2"></i>' +
                                    '</div>' +
                                    '<div class="dropdown-menu dropdown-menu-right animated--fade-in" aria-labelledby="navbarDropdown">' +
                                    '<a class="dropdown-item" onclick="return modifyReply(' + ReplyCommentList[i].postSeq + ', ' + ReplyCommentList[i].commentSeq + ', ' + "'" + ReplyCommentList[i].content +"'" + ')">수정</a>' +
                                    '<form class="mr-1" method="post" action="/comment">' +
                                    '<input type="hidden" name="_method" value="patch">' +
                                    '<input type="hidden" name="commentSeq" value="' + ReplyCommentList[i].commentSeq + '">' +
                                    '<input type="hidden" name="postSeq" value="' + ReplyCommentList[i].postSeq + '">' +
                                    '<button class="dropdown-item" type="submit">삭제</button>' +
                                    '</form></div></nav></div></div></div></div></div>' +
                                    '<div class="col-xl-3" id="ReplyModDiv-' + ReplyCommentList[i].commentSeq + '" style="display: none"></div>' +
                                    '</div>';
                        }else {

                            html.innerHTML+= '<div class="col-xl-4" style="padding-left: 3rem">' +
                                    '<div class="card border-left h-10 py-2">' +
                                    '<div class="card-body">' +
                                    '<div class="row no-gutters align-items-center">' +
                                    '<div class="col mr-2">' +
                                    '<div class="border-bottom mb-1">' +
                                    '<div class="text-xl-left font-weight-bold text-primary text-uppercase mb-1" style="float: left">'+
                                    ReplyCommentList[i].commentWriteId +
                                    '</div>' +
                                    '<div class="text-xs text-right font-weight-bold text-uppercase mb-1">'+
                                    ReplyCommentList[i].commentWriteDt +
                                    '</div></div>' +
                                    '<div class="h5 mb-0 font-weight-bold text-gray-800 mt-2">'+
                                    ReplyCommentList[i].content +
                                    '</div></div></div></div></div></div>';
                        }

                        console.log(ReplyCommentList[i].writer);
                    }
                }else {
                    html.innerHTML ='<div class="col-xl-4"  style="padding-left: 3rem">' +
                    '<div class="card border-left h-10 py-2">' +
                    '<div class="card-body">' +
                    '<div class="row no-gutters align-items-center">' +
                    '<div class="col mr-2">' +
                    '<div class="h5 mb-0 font-weight-bold text-gray-800">등록된 답글이 없습니다.</div>' +
                    '</div></div></div></div></div>';
                }
                replyDiv.append(html);
            },
            error: function (request, status, error) {
                alert("code: " + request.status + "\n" + "error: " + error);
            }
        })
    };
    function offReplyComment(commentSeq){
        const replyDiv = document.getElementById('replyList-'+commentSeq);
        const onReplyComment = document.getElementById('onReplyComment-'+commentSeq);
        const offReplyComment = document.getElementById('offReplyComment-'+commentSeq);

        replyDiv.remove();
        onReplyComment.style.display = ""
        offReplyComment.style.display = "none"
    };
    function reply(i){
        const replyCommentPost = document.getElementById('replyCommentPost-'+i);
        if(replyCommentPost.style.display == "none"){
            replyCommentPost.style.display = ""
        }else if (replyCommentPost.style.display != "none"){
            replyCommentPost.style.display = "none"
        }
    };
    function modifyComment(commentSeq, postSeq, content){
        const parentComment = document.getElementById('parentComment-'+commentSeq);
        const modifyDiv = document.getElementById('modifyDiv-'+commentSeq);

        parentComment.style.display = "none"
        modifyDiv.style.display = ""

        const html = document.createElement("div");
        html.id = "parentCommentMod-" + commentSeq;
        html.innerHTML+= '<div class="card border-left h-10 py-2">' +
                '<div class="card-body">' +
                '<div class="row no-gutters align-items-center">' +
                '<div class="col mr-2">' +
                '<div class="h5 mb-0 font-weight-bold text-gray-800">' +
                '<form method="post" action="/comment">' +
                '<input type="hidden" name="_method" value="put">' +
                '<input type="hidden" name="commentDepth" value=0>' +
                '<input type="hidden" name="postSeq" value="' + postSeq + '">' +
                '<input type="hidden" name="commentSeq" value="' + commentSeq + '">' +
                '<input type="text" id="content" name="content" value="' + content + '">' +
                '<input type="submit" id="submit" value="수정" class="btn">' +
                '<a onclick="return modifyCommenCancel('+ commentSeq +')">취소</a>' +
                '</form>' +
                '</div></div></div></div></div>';
        modifyDiv.append(html);
    };
    function modifyCommenCancel(commentSeq){
        const parentComment = document.getElementById('parentComment-'+commentSeq);
        const parentCommentMod = document.getElementById('parentCommentMod-'+commentSeq);

        parentCommentMod.remove();
        parentComment.style.display = ""
    };

    function modifyReply(postSeq, commentSeq, content){
        const childComment = document.getElementById('childComment-'+commentSeq);
        const ReplyModDiv = document.getElementById('ReplyModDiv-'+commentSeq);

        childComment.style.display = "none"
        ReplyModDiv.style.display = ""

        const html = document.createElement("div");
        html.id = "childCommentMod-" + commentSeq;
        html.innerHTML+= '<div class="card border-left h-10 py-2">' +
                '<div class="card-body">' +
                '<div class="row no-gutters align-items-center">' +
                '<div class="col mr-2">' +
                '<div class="h5 mb-0 font-weight-bold text-gray-800">' +
                '<form method="post" action="/comment">' +
                '<input type="hidden" name="_method" value="put">' +
                '<input type="hidden" name="commentDepth" value=0>' +
                '<input type="hidden" name="postSeq" value="' + postSeq + '">' +
                '<input type="hidden" name="commentSeq" value="' + commentSeq + '">' +
                '<input type="text" id="content" name="content" value="' + content + '">' +
                '<input type="submit" id="submit" value="수정" class="btn">' +
                '<input value="취소" class="btn">' +
                '</form>' +
                '</div></div></div></div></div>';
        ReplyModDiv.append(html);
    };
</script>
<!-- /.container-fluid -->
{{>layout/footer}}