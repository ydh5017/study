<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.blog.mapper.CommentMapper">
    <!-- 댓글 등록 -->
    <insert id="commentAddProc" parameterType="CommentVo">
        INSERT
        INTO
            COMMENT
        (
            POSTSEQ,
            CONTENT,
            COMMENTWRITEID,
            COMMENTWRITEDT
        )
        VALUES
            (
                #{postSeq},
                #{content},
                #{commentWriteId},
                SYSDATE()
            )
    </insert>
    <!-- 댓글 리스트 -->
    <select id="getCommentList" parameterType="int" resultType="CommentVO">
        SELECT
            CG.COMMENTSEQ,
            CG.POSTSEQ,
            CG.CONTENT,
            CG.COMMENTDEPTH,
            CG.COMMENTGROUP,
            CG.COMMENTWRITEID,
            CG.COMMENTWRITEDT,
            CG.COMMENTCHGID,
            CG.COMMENTCHGDT
        FROM
            (SELECT
                 COMMENTSEQ,
                 POSTSEQ,
                 CONTENT,
                 COMMENTDEPTH,
                 IFNULL(COMMENTGROUP, COMMENTSEQ) AS COMMENTGROUP,
                 COMMENTWRITEID,
                 COMMENTWRITEDT,
                 COMMENTCHGID,
                 COMMENTCHGDT,
                 ISDELETED
             FROM COMMENT) AS CG
        WHERE POSTSEQ = #{postSeq}
        AND ISDELETED = 0
        ORDER BY COMMENTGROUP, COMMENTSEQ
    </select>
</mapper>